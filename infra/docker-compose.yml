services:
  postgres:
    image: postgres:15
    container_name: healthcare-postgres
    environment:
      POSTGRES_USER: healthcare
      POSTGRES_PASSWORD: healthcare123
      POSTGRES_DB: healthcare
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
    networks:
      - healthcare-network

  auth-service:
    build: ../auth-service
    container_name: healthcare-auth
    environment:
      DATABASE_URL: postgresql://healthcare:healthcare123@postgres:5432/healthcare
      SECRET_KEY: your-secret-key-here-change-in-production-12345
    ports:
      - "8001:8001"
    depends_on:
      - postgres
    networks:
      - healthcare-network
    restart: unless-stopped

  appointment-service:
    build: ../appointment-service
    container_name: healthcare-appointments
    environment:
      DATABASE_URL: postgresql://healthcare:healthcare123@postgres:5432/healthcare
      SECRET_KEY: your-secret-key-here-change-in-production-12345
    ports:
      - "8003:8003"
    depends_on:
      - postgres
    networks:
      - healthcare-network
    restart: unless-stopped

  notification-service:
    build: ../notification-service
    container_name: healthcare-notifications
    environment:
      SMTP_HOST: mailhog
      SMTP_PORT: 1025
      FROM_EMAIL: noreply@healthcare.local
    ports:
      - "8004:8004"
    depends_on:
      - mailhog
    networks:
      - healthcare-network
    restart: unless-stopped

  patient-service:
    build: ../patient-service
    container_name: healthcare-patients
    environment:
      DATABASE_URL: postgresql://healthcare:healthcare123@postgres:5432/healthcare
    ports:
      - "8005:8005"
    depends_on:
      - postgres
    networks:
      - healthcare-network
    restart: unless-stopped

  billing-service:
    build: ../billing-service
    container_name: healthcare-billing
    environment:
      DATABASE_URL: postgresql://healthcare:healthcare123@postgres:5432/healthcare
    ports:
      - "8007:8007"
    depends_on:
      - postgres
    networks:
      - healthcare-network
    restart: unless-stopped

  gateway-service:
    build: ../gateway-service
    container_name: healthcare-gateway
    environment:
      AUTH_SERVICE_URL: http://auth-service:8001
      APPOINTMENT_SERVICE_URL: http://appointment-service:8003
      NOTIFICATION_SERVICE_URL: http://notification-service:8004
      PATIENT_SERVICE_URL: http://patient-service:8005
      BILLING_SERVICE_URL: http://billing-service:8007
      SECRET_KEY: your-secret-key-here-change-in-production-12345
      RATE_LIMIT_REQUESTS: 100
      RATE_LIMIT_WINDOW: 60
    ports:
      - "8090:8090"
    depends_on:
      - auth-service
      - appointment-service
      - notification-service
      - patient-service
      - billing-service
    networks:
      - healthcare-network
    restart: unless-stopped

  ui-service:
    build: ../ui-service
    container_name: healthcare-ui
    ports:
      - "3000:3000"
    depends_on:
      - gateway-service
    networks:
      - healthcare-network
    restart: unless-stopped

  mailhog:
    image: mailhog/mailhog:latest
    container_name: healthcare-mailhog
    ports:
      - "1025:1025"
      - "8025:8025"
    networks:
      - healthcare-network

networks:
  healthcare-network:
    driver: bridge

volumes:
  postgres_data:
