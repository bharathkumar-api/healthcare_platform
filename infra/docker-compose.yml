version: "3.8"

services:
  postgres:
    image: postgres:15-alpine
    container_name: healthcare-db
    environment:
      POSTGRES_USER: healthcare
      POSTGRES_PASSWORD: healthcare123
      POSTGRES_DB: healthcare
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U healthcare"]
      interval: 5s
      timeout: 5s
      retries: 5

  mailhog:
    image: mailhog/mailhog:latest
    platform: linux/amd64
    container_name: healthcare-mailhog
    ports:
      - "1025:1025"
      - "8025:8025"

  auth-service:
    build: ../auth-service
    container_name: healthcare-auth
    environment:
      DATABASE_URL: postgresql://healthcare:healthcare123@postgres:5432/healthcare
      SECRET_KEY: your-super-secret-key-min-32-chars-long-change-in-production!!
      ALGORITHM: HS256
      ACCESS_TOKEN_EXPIRE_MINUTES: 30
      POSTGRES_USER: healthcare
      POSTGRES_PASSWORD: healthcare123
      POSTGRES_DB: healthcare
      POSTGRES_HOST: postgres
      POSTGRES_PORT: 5432
    ports:
      - "8001:8001"
    depends_on:
      postgres:
        condition: service_healthy
    restart: unless-stopped

  patient-service:
    build: ../patient-service
    container_name: healthcare-patient
    environment:
      DATABASE_URL: postgresql://healthcare:healthcare123@postgres:5432/healthcare
      SECRET_KEY: your-super-secret-key-min-32-chars-long-change-in-production!!
      ALGORITHM: HS256
      POSTGRES_USER: healthcare
      POSTGRES_PASSWORD: healthcare123
      POSTGRES_DB: healthcare
      POSTGRES_HOST: postgres
      POSTGRES_PORT: 5432
    ports:
      - "8002:8002"
    depends_on:
      postgres:
        condition: service_healthy
    restart: unless-stopped

  appointment-service:
    build: ../appointment-service
    container_name: healthcare-appointment
    environment:
      DATABASE_URL: postgresql://healthcare:healthcare123@postgres:5432/healthcare
      SECRET_KEY: your-super-secret-key-min-32-chars-long-change-in-production!!
      ALGORITHM: HS256
      POSTGRES_USER: healthcare
      POSTGRES_PASSWORD: healthcare123
      POSTGRES_DB: healthcare
      POSTGRES_HOST: postgres
      POSTGRES_PORT: 5432
    ports:
      - "8003:8003"
    depends_on:
      postgres:
        condition: service_healthy
    restart: unless-stopped

  notification-service:
    build: ../notification-service
    container_name: healthcare-notification
    environment:
      SMTP_HOST: mailhog
      SMTP_PORT: 1025
      FROM_EMAIL: noreply@healthcare.com
    ports:
      - "8004:8004"
    depends_on:
      - mailhog
    restart: unless-stopped

  provider-service:
    build: ../provider-service
    container_name: healthcare-provider
    environment:
      DATABASE_URL: postgresql://healthcare:healthcare123@postgres:5432/healthcare
      SECRET_KEY: your-super-secret-key-min-32-chars-long-change-in-production!!
      ALGORITHM: HS256
      POSTGRES_USER: healthcare
      POSTGRES_PASSWORD: healthcare123
      POSTGRES_DB: healthcare
      POSTGRES_HOST: postgres
      POSTGRES_PORT: 5432
    ports:
      - "8005:8005"
    depends_on:
      postgres:
        condition: service_healthy
    restart: unless-stopped

  billing-service:
    build: ../billing-service
    container_name: healthcare-billing
    environment:
      DATABASE_URL: postgresql://healthcare:healthcare123@postgres:5432/healthcare
      SECRET_KEY: your-super-secret-key-min-32-chars-long-change-in-production!!
      ALGORITHM: HS256
      POSTGRES_USER: healthcare
      POSTGRES_PASSWORD: healthcare123
      POSTGRES_DB: healthcare
      POSTGRES_HOST: postgres
      POSTGRES_PORT: 5432
    ports:
      - "8006:8006"
    depends_on:
      postgres:
        condition: service_healthy
    restart: unless-stopped

  gateway-service:
    build: ../gateway-service
    container_name: healthcare-gateway
    environment:
      AUTH_SERVICE_URL: http://auth-service:8001
      PATIENT_SERVICE_URL: http://patient-service:8002
      APPOINTMENT_SERVICE_URL: http://appointment-service:8003
      NOTIFICATION_SERVICE_URL: http://notification-service:8004
      PROVIDER_SERVICE_URL: http://provider-service:8005
      BILLING_SERVICE_URL: http://billing-service:8006
      SECRET_KEY: your-super-secret-key-min-32-chars-long-change-in-production!!
    ports:
      - "8090:8090"
    depends_on:
      - auth-service
      - patient-service
      - appointment-service
      - notification-service
      - provider-service
      - billing-service
    restart: unless-stopped

  ui-service:
    build: ../ui-service
    container_name: healthcare-ui
    ports:
      - "3000:3000"
    depends_on:
      - gateway-service
    restart: unless-stopped

volumes:
  postgres_data:

networks:
  default:
    name: healthcare-network
